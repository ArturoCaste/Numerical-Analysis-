c***************************************************************************************************
c     Programa que emplea el método de Bairstow
c---------------------------------------------------------------------------------------------------
c     f_n(x) = a_n x^n + a_{n-1} x^{n-1}+ ... +a_2 x^2 + a_1 x_1 + a_0
c---------------------------------------------------------------------------------------------------
      program bairs 
c--------------------------------------------------------------------------------------------------- 
c     se debe ingresar un estimado incial x0
      real m3,m4,disc,r1,s1,s,r,m
      pi = 3.141592654
      open(1,file='ba1.dat',status='unknown')
      open(2,file='bai1.dat',status='unknown')
      open(3,file='ba2.dat',status='unknown')
c     write(*,*) 'Ingrese x0' 
c      read(*,*) x0
c     ingresamos una tolerancia
c     write(*,*) 'Ingrese la tolerancia' 

      write(*,*) '¿Cuál es el intervalo a graficar?'
      read(*,*) a,b
2      write(*,*) '¿Escriba un r1 y un s1?'
      read(*,*) r0, s0
c     Creamos los datos para graficar la funcion
      z=(abs(a)+ abs(b))/1000
      m=a
      write(2,*)
      do while (m.LE.b)
      	Fg=fob(m)
     	write(2,*) m,Fg
      	m=m+z
      end do
      
      
      a4 = 1
      a3 = -0.22411958
      a2 = 0.011658361
      a1 = -0.0005422539
      a0 = 0.000001251  
c      a4 = 1
c      a3 = 6
c      a2 = 11
c      a1 = 6
c      a0 = 0
      a22 = a2
      r = r0
      s = s0
      EE = 1E-4
c--------------------------------------------------------------------------------------------------- 
      Ear1 = 100
      Eas1 = 100
      Ear2 = 100
      Eas2 = 100
      write(1,*) '      s1  ','             ds1    ','          r1
     &','      dr1    '
      do while (Ear1.GT.EE.AND.Eas1.GT.EE)
     
        b4 = a4 
        b3 = a3 + r*b4 
        b2 = a2 + r*b3 + s*b4
        b1 = a1 + r*b2 + s*b3
        b0 = a0 + r*b1 + s*b2
c----------------------------------------------------------------------------------------------------
        c4 = b4 
        c3 = b3 + r*c4 
        c2 = b2 + r*c3 + s*c4
        c1 = b1 + r*c2 + s*c3
c---------------------------------------------------------------------------------------------------- 
    
        dr = (c3*b0 - b1*c2)/(c2**2 -c1*c3)
        ds = (c1*b1 - b0*c2)/(c2**2 -c1*c3)  
        r = r + dr
        s = s + ds 
        Ear1 = abs(dr/r)*100
        Eas1 = abs(ds/s)*100
c---------------------------------------------------------------------------------------------
        write(1,*) s,ds,r,dr
      end do
      r1 = r
      s1 = s
      x1= (r + sqrt( r**2 + 4*s))/2
      x2= (r - sqrt( r**2 + 4*s))/2
c----------------------------------------------------------------------------------------------
      a2 = b4
      a1 = b3
      a0 = b2 
      write(*,*) '***********************************'
      write(3,*) '      s2  ','           ds2    ','          r2
     &','     dr2    '
c-------------------------------------------------------------------------------------------------      
      do while (Ear2.GT.EE.AND.Eas2.GT.EE)
        
      b2 = a2  
      b1 = a1 + r1*b2 
      b0 = a0 + r1*b1 + s1*b2
c----------------------------------------------------------------------------------------------------
      c2 = b2 
      c1 = b2 + r1*c2
c---------------------------------------------------------------------------------------------------- 
      dr1 = (c3*b0 - b1*c2)/(c2**2 -c1*c3)
      ds1 = (c1*b1 - b0*c2)/(c2**2 -c1*c3)  
      r1 = r1 + dr1
      s1 = s1 + ds1 
      Ear2 = abs(dr1/r1)*100
      Eas2 = abs(ds1/s1)*100
 
c---------------------------------------------------------------------------------------------
      write(3,*) s1,ds1,r1,dr1 
      end do
      
      disc = r1**2 + 4*s1
     
      im1 = 0
      im2 = 0 
      m3 = sqrt(abs(disc))/2
      m4 = -m3
      re3 = r1/2
      re4= re3
c      write(3,*) '   x1(re)  ','   x1(im)  ','  x2(re) 
c     & ','   x2(im)  ','    x3(re) ', '  x3(im)           
c     & ', '  x4(re) ',  '    x4(im)   '
      write(*,*) '         Re  ', '             Im  '  
      write(*,*) x1,im1
      write(*,*) x2,im2
      write(*,*) re3,m3
      write(*,*) re4,m4
      
      if (x1.EQ.x3) then
           write(*,*) 'Se repite la raíz'
c          goto 2
      end if 
      

      close (1,status='keep')
      close (2,status='keep')
      close (3,status='keep')

      end program 

c**********************************************************************************************************
      function fob(x)
c**********************************************************************************************************
      
      fob = x**4 - 0.22411958*x**3  + 0.011658361*x**2  - 0.0005422539*x + 0.000001251   
     
      end function
c----------------------------------------------------------------------------------------------------------

c**********************************************************************************************************
      function fob1(x)
c**********************************************************************************************************
      
      fob1 = fob(x)/(x1**2 - r1*x - s)    
     
      end function
c----------------------------------------------------------------------------------------------------------




